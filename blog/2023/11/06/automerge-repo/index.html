<!doctype html>
<html lang="en" dir="ltr" class="blog-wrapper blog-post-page plugin-blog plugin-id-default">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.4.1">
<title data-rh="true">Automerge-Repo: A &quot;batteries-included&quot; toolkit for building local-first applications | Automerge CRDT</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://automerge.github.io/blog/2023/11/06/automerge-repo/"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docusaurus_tag" content="default"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docsearch:docusaurus_tag" content="default"><meta data-rh="true" name="title" content="Automerge"><meta data-rh="true" name="keywords" content="documentation, local-first, crdt, offline-first, automerge"><meta data-rh="true" property="og:title" content="Automerge-Repo: A &quot;batteries-included&quot; toolkit for building local-first applications | Automerge CRDT"><meta data-rh="true" name="description" content="Today we are announcing our new library, automerge-repo, which makes it vastly easier to build local-first applications with Automerge. Take a look at our quickstart guide or read on for some background and examples."><meta data-rh="true" property="og:description" content="Today we are announcing our new library, automerge-repo, which makes it vastly easier to build local-first applications with Automerge. Take a look at our quickstart guide or read on for some background and examples."><meta data-rh="true" property="og:type" content="article"><meta data-rh="true" property="article:published_time" content="2023-11-06T00:00:00.000Z"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://automerge.github.io/blog/2023/11/06/automerge-repo/"><link data-rh="true" rel="alternate" href="https://automerge.github.io/blog/2023/11/06/automerge-repo/" hreflang="en"><link data-rh="true" rel="alternate" href="https://automerge.github.io/blog/2023/11/06/automerge-repo/" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Automerge CRDT RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Automerge CRDT Atom Feed">




<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.13.24/dist/katex.min.css" integrity="sha384-odtC+0UGzzFL/6PNoE8rX/SPcQDXBJ+uRepguP4QkPCm2LBxH3FA3y+fKSiJ+AmM" crossorigin="anonymous"><link rel="stylesheet" href="/assets/css/styles.29d709e1.css">
<link rel="preload" href="/assets/js/runtime~main.0d6f35b6.js" as="script">
<link rel="preload" href="/assets/js/main.9f641c0f.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}return t}()||function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/automerge.png" alt="Automerge logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/img/automerge.png" alt="Automerge logo" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">Automerge</b></a><a class="navbar__item navbar__link" href="/docs/hello/">Docs</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/automerge" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="container margin-vert--lg"><div class="row"><aside class="col col--3"><nav class="sidebar_re4s thin-scrollbar" aria-label="Blog recent posts navigation"><div class="sidebarItemTitle_pO2u margin-bottom--md">Recent posts</div><ul class="sidebarItemList_Yudw clean-list"><li class="sidebarItem__DBe"><a aria-current="page" class="sidebarItemLink_mo7H sidebarItemLinkActive_I1ZP" href="/blog/2023/11/06/automerge-repo/">Automerge-Repo: A &quot;batteries-included&quot; toolkit for building local-first applications</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/automerge-2/">Automerge 2.0</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/welcome/">Welcome</a></li></ul></nav></aside><main class="col col--7" itemscope="" itemtype="http://schema.org/Blog"><article itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h1 class="title_f1Hy" itemprop="headline">Automerge-Repo: A &quot;batteries-included&quot; toolkit for building local-first applications</h1><div class="container_mt6G margin-vert--md"><time datetime="2023-11-06T00:00:00.000Z" itemprop="datePublished">November 6, 2023</time> Â· <!-- -->10 min read</div></header><div id="__blog-post-container" class="markdown" itemprop="articleBody"><p>Today we are announcing our new library, <a href="https://github.com/automerge/automerge-repo" target="_blank" rel="noopener noreferrer"><code>automerge-repo</code></a>, which makes it vastly easier to build local-first applications with Automerge. Take a look at our <a href="/docs/quickstart/">quickstart guide</a> or read on for some background and examples.</p><p>For those new to this idea: local-first applications are a way of building software that allows both real-time collaboration (think Google Docs) and offline working (think Git). They work by storing the user&#x27;s data locally, on their own device, and syncing it with collaborators in the background. You can read more about the motivation for local-first software <a href="https://inkandswitch.com/local-first/" target="_blank" rel="noopener noreferrer">in our essay</a>, or watch a <a href="https://www.youtube.com/watch?v=PHz17gwiOc8" target="_blank" rel="noopener noreferrer">talk introducing the idea</a>.</p><p>A challenge in local-first software is how to merge edits that were made independently on different devices, and <a href="https://crdt.tech/" target="_blank" rel="noopener noreferrer">CRDTs</a> were developed to solve this problem. Automerge is a fairly mature CRDT implementation. In fact, we wrote this blog post using it! The API is quite low-level though, and Automerge-Core has no opinion about how networking or storage should be done. Often, the first thing developers ask after discovering Automerge was how to connect it into an actual application.</p><p>Our new library, <code>automerge-repo</code>, extends the collaboration engine of Automerge-Core with networking and storage adapters, and provides integrations with React and other UI frameworks. You can get to building your app straight away by taking advantage of default implementations that solve common problems such as how to send binary data over a WebSocket, how often to send synchronization messages, what network format to use, or how to store data in places like the browser&#x27;s IndexedDB or on the filesystem.</p><p>If you&#x27;ve been intimidated by the effort of integrating Automerge into your application because of these choices, this library is for you. Now you can simply create a repo, point it to a sync server, and get to work on your app.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="automerge-repo-a-simple-example"><code>automerge-repo</code>: a simple example<a href="#automerge-repo-a-simple-example" class="hash-link" aria-label="Direct link to automerge-repo-a-simple-example" title="Direct link to automerge-repo-a-simple-example">â€‹</a></h2><p>Let&#x27;s start by taking a look at a simple example of how <code>automerge-repo</code> works. To begin, create and configure a repository for Automerge documents.</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">const repo = new Repo({</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  storage: new IndexedDBStorageAdapter(&quot;automerge-demo&quot;),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  network: [new WebsocketClientNetworkAdapter(&quot;wss://sync.automerge.org&quot;)]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">})</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The code in the example above creates a repository and adds a storage and network adapter to it. It tells <code>automerge-repo</code> to store all changes in an IndexedDB table called <code>automerge-demo</code> and to synchronize documents with the WebSocket server at <code>sync.automerge.org</code>. The library is designed to support a wide variety of network transports, and we include a simple client/server WebSocket adapter out of the box. Members of the community are already adding support for other transports, such as WebRTC.</p><p>In this example we&#x27;re connecting to the public test server hosted by the Automerge team, but you can also run your own sync server. In fact, our <a href="https://github.com/automerge/automerge-repo-sync-server" target="_blank" rel="noopener noreferrer">sync server</a> runs almost the same code as above, but with a different network and storage adapter.</p><div class="theme-admonition theme-admonition-note alert alert--secondary admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</div><div class="admonitionContent_S0QG"><p>The Automerge project provides a public sync server for you to experiment with <code>sync.automerge.org</code>. This is not a private instance, and as an experimental service has no reliability or data safety guarantees. Basically, it&#x27;s good for demos and prototyping, but run your own sync server for production uses.</p></div></div><p>Next, create a document and make some changes to it:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">   &gt; const handle = repo.create()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   &gt; handle.change(doc =&gt; { doc.hello = &quot;World.&quot; })</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   &gt; console.log(handle.url)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   automerge:2j9knpCseyhnK8izDmLpGP5WMdZQ</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The code logs a URL to the document you created. On another computer, or in another browser, you could load this document using the same URL, as shown below:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">   &gt; const handle = repo.find(&quot;automerge:2j9knpCseyhnK8izDmLpGP5WMdZQ&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   &gt; console.log(await handle.doc())</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   // why don&#x27;t you try it and find out?</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>What&#x27;s happening here to make all this work? <code>automerge-repo</code> wraps the core Automerge library and handles all the work of moving the bytes around to make your application function.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="key-concepts--basic-usage">Key Concepts &amp; Basic Usage<a href="#key-concepts--basic-usage" class="hash-link" aria-label="Direct link to Key Concepts &amp; Basic Usage" title="Direct link to Key Concepts &amp; Basic Usage">â€‹</a></h2><p>Let&#x27;s go into a bit more detail. For full documentation please see <a href="https://automerge.org/docs/repositories/" target="_blank" rel="noopener noreferrer">the docs</a>.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="repo">Repo<a href="#repo" class="hash-link" aria-label="Direct link to Repo" title="Direct link to Repo">â€‹</a></h3><p>Create a repo by initializing it with an optional storage plugin and any number of network adapters. These are the options for initializing a repo:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">export interface RepoConfig {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // A unique identifier for this peer, the default is a random id</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  peerId?: PeerId</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // Something which knows how to store and retrieve binary blobs</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  storage?: StorageAdapter</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // Something which knows how to send and receive sync messages</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  network: NetworkAdapter[]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // A function which determines whether to share a document with a peer</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  sharePolicy?: SharePolicy</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Don&#x27;t let the usage of &quot;peer&quot; confuse you into thinking this is limited to peer to peer connectivity, <code>automerge-repo</code> works with both client-server and peer-to-peer network transports.</p><p>The main methods on Repo are <code>find(url)</code> and <code>create()</code>, both of which return a <code>DocHandle</code> you can work with.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="handle--automerge-urls">Handle &amp; Automerge URLs<a href="#handle--automerge-urls" class="hash-link" aria-label="Direct link to Handle &amp; Automerge URLs" title="Direct link to Handle &amp; Automerge URLs">â€‹</a></h3><p>A <code>DocHandle</code> is a reference to an Automerge document that a <code>Repo</code> syncs and stores . The <code>Repo</code> instance saves any changes you make to the document and syncs with connected peers. Likewise, you can listen over the network for to a <code>Repo</code> for any changes it received.</p><p>Each <code>DocHandle</code> has a <code>.url</code> property. This is a string which uniquely identifies a document in the form <code>automerge:&lt;base58 encoded bytes&gt;</code>. Once you have a URL you can use it to request the document from other peers.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="dochandledoc-and-dochandledocsync"><code>DocHandle.doc()</code> and <code>DocHandle.docSync()</code><a href="#dochandledoc-and-dochandledocsync" class="hash-link" aria-label="Direct link to dochandledoc-and-dochandledocsync" title="Direct link to dochandledoc-and-dochandledocsync">â€‹</a></h3><p>These two methods return the current state of the document. <code>doc()</code> is an asynchronous method that resolves when a repository loads the document from storage or retrieves it from a peer (whichever happens first), and <code>docSync()</code> is a synchronous method that assumes the document is already available.
The examples below illustrate asynchronously loading a document or synchronously loading a document and then interacting with it:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">&gt; const handle = repo.find(&quot;automerge:2j9knpCseyhnK8izDmLpGP5WMdZQ&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&gt; const doc = await handle.doc()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&gt; console.log(doc)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Or </p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">&gt; const handle = repo.find(&quot;automerge:2j9knpCseyhnK8izDmLpGP5WMdZQ&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&gt; handle.whenReady().then(() =&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  console.log(handle.docSync())</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">})</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>In this latter example we use <code>DocHandle.whenReady</code>, which returns a promise that the repository resolves when it loads a document from storage or fetches it from another peer in the network.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="change-and-onchange"><code>change()</code> and <code>on(&quot;change&quot;)</code><a href="#change-and-onchange" class="hash-link" aria-label="Direct link to change-and-onchange" title="Direct link to change-and-onchange">â€‹</a></h3><p>Use <code>DocHandle.change</code> when you modify a document.</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">&gt; const handle = repo.find(&quot;automerge:2j9knpCseyhnK8izDmLpGP5WMdZQ&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&gt; await handle.doc()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&gt; handle.change(d =&gt; d.foo = &quot;bar&quot;)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The <code>Repo</code> calls <code>DocHandle.on(&quot;change&quot;)</code> whenever the document is modified â€“ either due to a local change or a sync message being received from another peer.</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">&gt; const handle = repo.find(&quot;automerge:4CkUej7mAYnaFMfVnffDipc4Mtvn&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&gt; await handle.doc()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&gt; handle.on(&quot;change&quot;, ({doc}) =&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  console.log(&quot;document changed&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  console.log(&quot;New content: &quot;, doc)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">})</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="integrations">Integrations<a href="#integrations" class="hash-link" aria-label="Direct link to Integrations" title="Direct link to Integrations">â€‹</a></h2><p><code>automerge-repo</code> provides a set of primitives that you can use to build a wide range of applications. To make this easier, we have built integrations with a few common UI frameworks. You can easily add further integrations and we welcome contributions which integrate with popular frameworks!</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="react-integration">React Integration<a href="#react-integration" class="hash-link" aria-label="Direct link to React Integration" title="Direct link to React Integration">â€‹</a></h3><p><a href="https://www.npmjs.com/package/@automerge/automerge-repo-react-hooks" target="_blank" rel="noopener noreferrer"><code>@automerge/automerge-repo-react-hooks</code></a> makes it easy to use <code>automerge-repo</code> in a React application. Once you&#x27;ve constructed a <code>Repo</code> you can make it available to your React application using <a href="https://automerge.org/automerge-repo/variables/_automerge_automerge_repo_react_hooks.RepoContext.html" target="_blank" rel="noopener noreferrer"><code>RepoContext</code></a>. Once available, call <code>useHandle</code> to obtain a <code>DocHandle</code>:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">function TodoList(listUrl: AutomergeUrl) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    const handle = useHandle(listUrl)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // render the todolist</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Note that when <code>Repo</code> receives changes over the network or registers local changes, the original Automerge document remains immutable, and any modified parts of the document get new objects. This means that React will only re-render the parts of the UI that depend on a part of the document that has changed.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="svelte-integration">Svelte Integration<a href="#svelte-integration" class="hash-link" aria-label="Direct link to Svelte Integration" title="Direct link to Svelte Integration">â€‹</a></h3><p><a href="https://www.npmjs.com/package/@automerge/automerge-repo-svelte-store" target="_blank" rel="noopener noreferrer"><code>@automerge/automerge-repo-svelte-store</code></a> provides <code>setContextRepo</code> to set the <code>Repo</code> which is used by the <code>document</code> store:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">&lt;script lang=&quot;ts&quot;&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  import { document } from &quot;@automerge/automerge-repo-svelte-store&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  import { type AutomergeUrl } from &quot;@automerge/automerge-repo&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  export let documentUrl: AutomergeUrl</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // Doc is an automerge store with a `change` method which accepts</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // a standard automerge change function</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  const doc = document&lt;HasCount&gt;(documentUrl)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  const increment = () =&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    doc.change((d: HasCount) =&gt; (d.count = (d.count || 0) + 1))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt;/script&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt;button on:click={increment}&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  count is {$doc?.count || 0}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt;/button&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="what-about-x">What about <!-- -->&lt;<!-- -->X<!-- -->&gt;<!-- -->?<a href="#what-about-x" class="hash-link" aria-label="Direct link to what-about-x" title="Direct link to what-about-x">â€‹</a></h2><p>We&#x27;d love to help you make automerge work in your favorite development environment! Please reach out to us on GitHub or via <a href="https://join.slack.com/t/automerge/shared_invite/zt-e4p3760n-kKh7r3KRH1YwwNfiZM8ktw" target="_blank" rel="noopener noreferrer">our Slack</a>.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="extending-automerge-repo">Extending <code>automerge-repo</code><a href="#extending-automerge-repo" class="hash-link" aria-label="Direct link to extending-automerge-repo" title="Direct link to extending-automerge-repo">â€‹</a></h2><p>You can extend <code>automerge-repo</code> by writing new storage or network adapters.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="storage-adapters">Storage Adapters<a href="#storage-adapters" class="hash-link" aria-label="Direct link to Storage Adapters" title="Direct link to Storage Adapters">â€‹</a></h3><p>A storage adapter represents some kind of backend that stores the data in a repo. Storage adapters can be implemented for any key/value store that allows you to query a range of keys with a given prefix. There is no concurrency control required (that&#x27;s implemented in <code>automerge-repo</code>) so you can safely have multiple repos pointing at the same storage. For example, you could implement an adapter on top of Redis.</p><p>The <code>automerge-repo</code> library provides storage adapters for IndexedDB and the file system (on Node).</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="network-adapters">Network Adapters<a href="#network-adapters" class="hash-link" aria-label="Direct link to Network Adapters" title="Direct link to Network Adapters">â€‹</a></h3><p>A network adapter represents a way of connecting to other peers. Network adapters raise events when a new peer is discovered or when a message is recieved, and implement a <code>send</code> method for transmitting messages to another peer. <code>automerge-repo</code> assumes a reliable, in-order transport for each peer; as long as you can provide this (e.g. using a TCP connection), you can implement an adapter. You could implement an adapter for <a href="https://en.wikipedia.org/wiki/Bluetooth_Low_Energy" target="_blank" rel="noopener noreferrer">BLE</a>, for example.</p><p>The <code>automerge-repo</code> library provides network adapters for WebSocket, MessageChannel, and BroadcastChannel.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="other-languagesplatforms">Other languages/platforms<a href="#other-languagesplatforms" class="hash-link" aria-label="Direct link to Other languages/platforms" title="Direct link to Other languages/platforms">â€‹</a></h3><p>This release of <code>automerge-repo</code> is just for javascript. Automerge is a multi-language library though and there are efforts under way to implement <code>automerge-repo</code> on other platforms. The most mature of these is <a href="https://github.com/automerge/automerge-repo-rs" target="_blank" rel="noopener noreferrer"><code>automerge-repo-rs</code></a>. We welcome contributions and please reach out if you&#x27;re starting to develop <code>automerge-repo</code> for a new platform.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="beta-quality">Beta Quality<a href="#beta-quality" class="hash-link" aria-label="Direct link to Beta Quality" title="Direct link to Beta Quality">â€‹</a></h2><p><code>automerge-repo</code> works pretty well â€“ we&#x27;re using it at <a href="https://www.inkandswitch.com/" target="_blank" rel="noopener noreferrer">Ink &amp; Switch</a> for a bunch of internal projects. The basic shape of the API is simple and useful, and not having to think about the plumbing makes it much, much faster to get a useful application off the ground. However, there are some performance problems we&#x27;re working on:</p><ol><li>Documents with large histories (e.g. a collaboratively edited document with &gt;60,000 edits) can be slow to sync.</li><li>The sync protocol currently requires that a document it is syncing be loaded into memory. This means that a sync server can struggle to handle a lot of traffic on large documents.</li></ol><p>These two points mean that we&#x27;re not ready to say this project is ready for production. </p><p>We&#x27;re working hard on fixing the performance so that we <em>can</em> say this is ready for production. But if you are interested in experimenting with the library now, or if you are only going to be working with relatively small documents or low traffic sync servers then you are good to go!</p><p>(If you want us to get to production faster, or you have some specific requirements, please consider <a href="https://github.com/sponsors/automerge" target="_blank" rel="noopener noreferrer">sponsoring</a> Automerge development ðŸ™‚)</p><p>Finally, we don&#x27;t want to give the impression that everything is smooth sailing. <code>automerge-repo</code> solves a bunch of the hard problems people were encountering around networking and storage. There are still plenty of other difficult problems in local first software where we don&#x27;t have turnkey solutions: authentication and authorization, end-to-end encryption, schema changes, version control workflows etc. <code>automerge-repo</code> makes many things much easier, but it&#x27;s a frontier out here.</p></div><footer class="row docusaurus-mt-lg blogPostFooterDetailsFull_mRVl"><div class="col margin-top--sm"><a href="https://github.com/automerge/automerge.github.io/edit/main/blog/2023-11-06-automerge-repo.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Blog post page navigation"><a class="pagination-nav__link pagination-nav__link--next" href="/blog/automerge-2/"><div class="pagination-nav__sublabel">Older Post</div><div class="pagination-nav__label">Automerge 2.0</div></a></nav></main><div class="col col--2"><div class="tableOfContents_bqdL thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#automerge-repo-a-simple-example" class="table-of-contents__link toc-highlight"><code>automerge-repo</code>: a simple example</a></li><li><a href="#key-concepts--basic-usage" class="table-of-contents__link toc-highlight">Key Concepts &amp; Basic Usage</a><ul><li><a href="#repo" class="table-of-contents__link toc-highlight">Repo</a></li><li><a href="#handle--automerge-urls" class="table-of-contents__link toc-highlight">Handle &amp; Automerge URLs</a></li><li><a href="#dochandledoc-and-dochandledocsync" class="table-of-contents__link toc-highlight"><code>DocHandle.doc()</code> and <code>DocHandle.docSync()</code></a></li><li><a href="#change-and-onchange" class="table-of-contents__link toc-highlight"><code>change()</code> and <code>on(&quot;change&quot;)</code></a></li></ul></li><li><a href="#integrations" class="table-of-contents__link toc-highlight">Integrations</a><ul><li><a href="#react-integration" class="table-of-contents__link toc-highlight">React Integration</a></li><li><a href="#svelte-integration" class="table-of-contents__link toc-highlight">Svelte Integration</a></li></ul></li><li><a href="#what-about-x" class="table-of-contents__link toc-highlight">What about &lt;X&gt;?</a></li><li><a href="#extending-automerge-repo" class="table-of-contents__link toc-highlight">Extending <code>automerge-repo</code></a><ul><li><a href="#storage-adapters" class="table-of-contents__link toc-highlight">Storage Adapters</a></li><li><a href="#network-adapters" class="table-of-contents__link toc-highlight">Network Adapters</a></li><li><a href="#other-languagesplatforms" class="table-of-contents__link toc-highlight">Other languages/platforms</a></li></ul></li><li><a href="#beta-quality" class="table-of-contents__link toc-highlight">Beta Quality</a></li></ul></div></div></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs/quickstart/">Quick Start</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://join.slack.com/t/automerge/shared_invite/zt-e4p3760n-kKh7r3KRH1YwwNfiZM8ktw" target="_blank" rel="noopener noreferrer" class="footer__link-item">Slack community<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://inkandswitch.com" target="_blank" rel="noopener noreferrer" class="footer__link-item">Ink &amp; Switch<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/blog/">Blog</a></li><li class="footer__item"><a href="https://github.com/automerge/automerge" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright Â© 2023 Automerge contributors. Built with Docusaurus.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.0d6f35b6.js"></script>
<script src="/assets/js/main.9f641c0f.js"></script>
</body>
</html>